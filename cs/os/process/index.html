
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://fuuzen.github.io/notebook/cs/os/process/">
      
      
        <link rel="prev" href="../memory-management/">
      
      
        <link rel="next" href="../scheduling/">
      
      
      <link rel="icon" href="../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>进程 - 風船の笔记本</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <meta name="google-site-verification" content="7QiG8wJPa5_9Ca0Y8hlhT0rJtNqEekDbao8u-zvq7zA"/>
  <meta name="msvalidate.01" content="9A952D9AAB23A5CE98B20FC76E335FA6"/>
  <meta name="yandex-verification" content="cb2a7fddf83f1d59"/>

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#进程的基本概念" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="風船の笔记本" class="md-header__button md-logo" aria-label="風船の笔记本" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            風船の笔记本
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              进程
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Cs

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ie/" class="md-tabs__link">
          
  
    
  
  Ie

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../math/" class="md-tabs__link">
          
  
    
  
  Math

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../si-zheng/" class="md-tabs__link">
          
  
    
  
  Si zheng

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="風船の笔记本" class="md-nav__button md-logo" aria-label="風船の笔记本" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    風船の笔记本
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Cs
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Cs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../ai/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Ai
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../data-structure-and-algorithm/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Data structure and algorithm
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../fronet-end/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Fronet end
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../languages/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Languages
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Os
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Os
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    操作系统绪论
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deadlock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    死锁
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    文件系统
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    I/O
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linux-customized-syscall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    给Linux内核增加自定义系统调用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memory-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内存管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    进程
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    进程
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#进程的基本概念" class="md-nav__link">
    <span class="md-ellipsis">
      进程的基本概念
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程的基本概念">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#进程的定义" class="md-nav__link">
    <span class="md-ellipsis">
      进程的定义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#区分进程程序进程实体" class="md-nav__link">
    <span class="md-ellipsis">
      区分进程、程序、进程实体
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#进程实体的组成" class="md-nav__link">
    <span class="md-ellipsis">
      进程实体的组成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcb" class="md-nav__link">
    <span class="md-ellipsis">
      PCB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PCB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcb-的结构" class="md-nav__link">
    <span class="md-ellipsis">
      PCB 的结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-的-pcb" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 的 PCB
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#进程的特征" class="md-nav__link">
    <span class="md-ellipsis">
      进程的特征
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#进程的状态与转换" class="md-nav__link">
    <span class="md-ellipsis">
      进程的状态与转换
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程的状态与转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#五状态模型" class="md-nav__link">
    <span class="md-ellipsis">
      五状态模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#七状态模型" class="md-nav__link">
    <span class="md-ellipsis">
      七状态模型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#进程组织" class="md-nav__link">
    <span class="md-ellipsis">
      进程组织
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程组织">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#链接式组织进程" class="md-nav__link">
    <span class="md-ellipsis">
      链接式组织进程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#索引式组织进程" class="md-nav__link">
    <span class="md-ellipsis">
      索引式组织进程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#进程控制" class="md-nav__link">
    <span class="md-ellipsis">
      进程控制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程控制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#系统调用" class="md-nav__link">
    <span class="md-ellipsis">
      系统调用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="系统调用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linux-举例" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 举例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux 举例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fork" class="md-nav__link">
    <span class="md-ellipsis">
      fork
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exec" class="md-nav__link">
    <span class="md-ellipsis">
      exec*
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wait和waitpid" class="md-nav__link">
    <span class="md-ellipsis">
      wait和waitpid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forkexec" class="md-nav__link">
    <span class="md-ellipsis">
      fork+exec*
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forkexecwait" class="md-nav__link">
    <span class="md-ellipsis">
      fork+exec*+wait
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exit" class="md-nav__link">
    <span class="md-ellipsis">
      exit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abort" class="md-nav__link">
    <span class="md-ellipsis">
      abort
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#进程控制原语" class="md-nav__link">
    <span class="md-ellipsis">
      进程控制原语
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#创建" class="md-nav__link">
    <span class="md-ellipsis">
      创建
    </span>
  </a>
  
    <nav class="md-nav" aria-label="创建">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#根进程" class="md-nav__link">
    <span class="md-ellipsis">
      根进程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#孤儿进程" class="md-nav__link">
    <span class="md-ellipsis">
      孤儿进程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#撤销" class="md-nav__link">
    <span class="md-ellipsis">
      撤销
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#阻塞" class="md-nav__link">
    <span class="md-ellipsis">
      阻塞
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#唤醒" class="md-nav__link">
    <span class="md-ellipsis">
      唤醒
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#切换" class="md-nav__link">
    <span class="md-ellipsis">
      切换
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#进程通信" class="md-nav__link">
    <span class="md-ellipsis">
      进程通信
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程通信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#共享存储" class="md-nav__link">
    <span class="md-ellipsis">
      共享存储
    </span>
  </a>
  
    <nav class="md-nav" aria-label="共享存储">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#基于存储区共享" class="md-nav__link">
    <span class="md-ellipsis">
      基于存储区共享
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基于存储区共享">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linux-共享内存" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 共享内存
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux 共享内存">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-id" class="md-nav__link">
    <span class="md-ellipsis">
      Key ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    <span class="md-ellipsis">
      Create
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#基于数据结构的共享" class="md-nav__link">
    <span class="md-ellipsis">
      基于数据结构的共享
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#消息传递" class="md-nav__link">
    <span class="md-ellipsis">
      消息传递
    </span>
  </a>
  
    <nav class="md-nav" aria-label="消息传递">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#直接通信方式" class="md-nav__link">
    <span class="md-ellipsis">
      直接通信方式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#间接通信方式" class="md-nav__link">
    <span class="md-ellipsis">
      间接通信方式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#同步异步" class="md-nav__link">
    <span class="md-ellipsis">
      同步/异步
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#缓存" class="md-nav__link">
    <span class="md-ellipsis">
      缓存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-接口实现" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 接口实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#posixpthread实现" class="md-nav__link">
    <span class="md-ellipsis">
      POSIX(pthread)实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mach" class="md-nav__link">
    <span class="md-ellipsis">
      Mach
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    <span class="md-ellipsis">
      Windows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#管道通信" class="md-nav__link">
    <span class="md-ellipsis">
      管道通信
    </span>
  </a>
  
    <nav class="md-nav" aria-label="管道通信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linux-实现" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipes-in-unix-cli" class="md-nav__link">
    <span class="md-ellipsis">
      Pipes in UNIX CLI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-实现" class="md-nav__link">
    <span class="md-ellipsis">
      Windows 实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#客户机-服务器系统中的通信" class="md-nav__link">
    <span class="md-ellipsis">
      客户机-服务器系统中的通信
    </span>
  </a>
  
    <nav class="md-nav" aria-label="客户机-服务器系统中的通信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#套间字socket" class="md-nav__link">
    <span class="md-ellipsis">
      套间字(Socket)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#远程过程调用rpc" class="md-nav__link">
    <span class="md-ellipsis">
      远程过程调用(RPC)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="远程过程调用(RPC)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dce-rpc" class="md-nav__link">
    <span class="md-ellipsis">
      DCE RPC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#进程调度" class="md-nav__link">
    <span class="md-ellipsis">
      进程调度
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scheduling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    调度
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sync/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    经典进程同步问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../thread/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../ysosv2/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Ysosv2
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../parallel-programing/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Parallel programing
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../principles-of-computer-composition/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Principles of computer composition
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../tools/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Tools
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../ie/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Ie
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../math/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Math
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../si-zheng/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Si zheng
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#进程的基本概念" class="md-nav__link">
    <span class="md-ellipsis">
      进程的基本概念
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程的基本概念">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#进程的定义" class="md-nav__link">
    <span class="md-ellipsis">
      进程的定义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#区分进程程序进程实体" class="md-nav__link">
    <span class="md-ellipsis">
      区分进程、程序、进程实体
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#进程实体的组成" class="md-nav__link">
    <span class="md-ellipsis">
      进程实体的组成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pcb" class="md-nav__link">
    <span class="md-ellipsis">
      PCB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PCB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcb-的结构" class="md-nav__link">
    <span class="md-ellipsis">
      PCB 的结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-的-pcb" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 的 PCB
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#进程的特征" class="md-nav__link">
    <span class="md-ellipsis">
      进程的特征
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#进程的状态与转换" class="md-nav__link">
    <span class="md-ellipsis">
      进程的状态与转换
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程的状态与转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#五状态模型" class="md-nav__link">
    <span class="md-ellipsis">
      五状态模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#七状态模型" class="md-nav__link">
    <span class="md-ellipsis">
      七状态模型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#进程组织" class="md-nav__link">
    <span class="md-ellipsis">
      进程组织
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程组织">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#链接式组织进程" class="md-nav__link">
    <span class="md-ellipsis">
      链接式组织进程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#索引式组织进程" class="md-nav__link">
    <span class="md-ellipsis">
      索引式组织进程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#进程控制" class="md-nav__link">
    <span class="md-ellipsis">
      进程控制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程控制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#系统调用" class="md-nav__link">
    <span class="md-ellipsis">
      系统调用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="系统调用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linux-举例" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 举例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux 举例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fork" class="md-nav__link">
    <span class="md-ellipsis">
      fork
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exec" class="md-nav__link">
    <span class="md-ellipsis">
      exec*
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wait和waitpid" class="md-nav__link">
    <span class="md-ellipsis">
      wait和waitpid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forkexec" class="md-nav__link">
    <span class="md-ellipsis">
      fork+exec*
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forkexecwait" class="md-nav__link">
    <span class="md-ellipsis">
      fork+exec*+wait
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exit" class="md-nav__link">
    <span class="md-ellipsis">
      exit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abort" class="md-nav__link">
    <span class="md-ellipsis">
      abort
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#进程控制原语" class="md-nav__link">
    <span class="md-ellipsis">
      进程控制原语
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#创建" class="md-nav__link">
    <span class="md-ellipsis">
      创建
    </span>
  </a>
  
    <nav class="md-nav" aria-label="创建">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#根进程" class="md-nav__link">
    <span class="md-ellipsis">
      根进程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#孤儿进程" class="md-nav__link">
    <span class="md-ellipsis">
      孤儿进程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#撤销" class="md-nav__link">
    <span class="md-ellipsis">
      撤销
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#阻塞" class="md-nav__link">
    <span class="md-ellipsis">
      阻塞
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#唤醒" class="md-nav__link">
    <span class="md-ellipsis">
      唤醒
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#切换" class="md-nav__link">
    <span class="md-ellipsis">
      切换
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#进程通信" class="md-nav__link">
    <span class="md-ellipsis">
      进程通信
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程通信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#共享存储" class="md-nav__link">
    <span class="md-ellipsis">
      共享存储
    </span>
  </a>
  
    <nav class="md-nav" aria-label="共享存储">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#基于存储区共享" class="md-nav__link">
    <span class="md-ellipsis">
      基于存储区共享
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基于存储区共享">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linux-共享内存" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 共享内存
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux 共享内存">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-id" class="md-nav__link">
    <span class="md-ellipsis">
      Key ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    <span class="md-ellipsis">
      Create
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#基于数据结构的共享" class="md-nav__link">
    <span class="md-ellipsis">
      基于数据结构的共享
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#消息传递" class="md-nav__link">
    <span class="md-ellipsis">
      消息传递
    </span>
  </a>
  
    <nav class="md-nav" aria-label="消息传递">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#直接通信方式" class="md-nav__link">
    <span class="md-ellipsis">
      直接通信方式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#间接通信方式" class="md-nav__link">
    <span class="md-ellipsis">
      间接通信方式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#同步异步" class="md-nav__link">
    <span class="md-ellipsis">
      同步/异步
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#缓存" class="md-nav__link">
    <span class="md-ellipsis">
      缓存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-接口实现" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 接口实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#posixpthread实现" class="md-nav__link">
    <span class="md-ellipsis">
      POSIX(pthread)实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mach" class="md-nav__link">
    <span class="md-ellipsis">
      Mach
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    <span class="md-ellipsis">
      Windows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#管道通信" class="md-nav__link">
    <span class="md-ellipsis">
      管道通信
    </span>
  </a>
  
    <nav class="md-nav" aria-label="管道通信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linux-实现" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipes-in-unix-cli" class="md-nav__link">
    <span class="md-ellipsis">
      Pipes in UNIX CLI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-实现" class="md-nav__link">
    <span class="md-ellipsis">
      Windows 实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#客户机-服务器系统中的通信" class="md-nav__link">
    <span class="md-ellipsis">
      客户机-服务器系统中的通信
    </span>
  </a>
  
    <nav class="md-nav" aria-label="客户机-服务器系统中的通信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#套间字socket" class="md-nav__link">
    <span class="md-ellipsis">
      套间字(Socket)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#远程过程调用rpc" class="md-nav__link">
    <span class="md-ellipsis">
      远程过程调用(RPC)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="远程过程调用(RPC)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dce-rpc" class="md-nav__link">
    <span class="md-ellipsis">
      DCE RPC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#进程调度" class="md-nav__link">
    <span class="md-ellipsis">
      进程调度
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>进程</h1>

<h2 id="进程的基本概念">进程的基本概念<a class="headerlink" href="#进程的基本概念" title="Permanent link">&para;</a></h2>
<h3 id="进程的定义">进程的定义<a class="headerlink" href="#进程的定义" title="Permanent link">&para;</a></h3>
<p>典型的定义：</p>
<ul>
<li>进程是<strong>进程实体的运行过程</strong>，是系统进行资源分配和调度的一个<strong>独立单位</strong>**</li>
<li>一个具有独立功能的程序在一个数据集合上运行的过程</li>
</ul>
<h3 id="区分进程程序进程实体">区分<strong>进程</strong>、<strong>程序</strong>、<strong>进程实体</strong><a class="headerlink" href="#区分进程程序进程实体" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>程序（Program）：是静态的，就是个存放在磁盘里的可执行文件，就是一系列的指令集合</p>
</li>
<li>
<p>静态连接</p>
</li>
<li>
<p>动态链接</p>
</li>
<li>
<p>进程（Process）：是动态的，是程序的一次执行过程</p>
</li>
<li>进程实体（进程映像）：是静态的，反应了进程在某一时刻的状态</li>
</ul>
<h3 id="进程实体的组成">进程实体的组成<a class="headerlink" href="#进程实体的组成" title="Permanent link">&para;</a></h3>
<p>一个<strong>进程实体（进程映像）</strong>由三个部分组成：</p>
<ul>
<li>PCB</li>
<li>进程描述信息</li>
<li>进程控制和管理信息</li>
<li>资源分配清单</li>
<li>处理机状态信息（<strong>CPU 上下文</strong>）</li>
<li>程序段</li>
<li>程序的代码（指令序列）</li>
<li>数据段</li>
<li>运行过程中产生的各种数据（如：程序中定义的变量）</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>PCB 是给操作系统用的；程序段、数据段是给进程自己用的，与进程自身的运行逻辑有关</p>
</div>
<h3 id="pcb">PCB<a class="headerlink" href="#pcb" title="Permanent link">&para;</a></h3>
<p>PCB 位于内存的<strong>内核</strong>空间里，创建之后常驻内存。</p>
<p>PCB 是进程存在的<strong>唯一标志</strong>，当进程被创建时，操作系统为其创建 PCB，当进程结束时，会会回收其 PCB。</p>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p>PCB <strong>几乎完备的表示了进程的状态</strong>，也就是说只要有一个进程的 PCB，就可以恢复对应的进程</p>
</div>
<h4 id="pcb-的结构">PCB 的结构<a class="headerlink" href="#pcb-的结构" title="Permanent link">&para;</a></h4>
<ul>
<li>进程描述信息</li>
<li>进程标识符 PID</li>
<li>用户标识符 UID</li>
<li>进程控制和管理信息</li>
<li>CPU、磁盘、网络流量使用情况统计 ⋯<ul>
<li>进入内存时间</li>
<li>CPU 占用时间</li>
<li>信号量使用</li>
</ul>
</li>
<li>进程当前状态：就绪态/阻塞态/运行态</li>
<li>代码运行入口地址</li>
<li>程序的外存地址</li>
<li>程序优先级</li>
<li>资源分配清单</li>
<li>正在使用（依赖）哪些文件<ul>
<li>文件描述符</li>
</ul>
</li>
<li>正在使用哪些内存区域<ul>
<li>代码段指针</li>
<li>数据段指针</li>
<li>堆栈段指针</li>
</ul>
</li>
<li>正在使用哪些 I/O 设备</li>
<li>处理机相关信息，也叫 <strong>CPU 的上下文</strong>（the context of the processor）</li>
<li>user-visible registers</li>
<li>control and status registers (CSR)</li>
<li>stack pointers</li>
<li>PSW<ul>
<li>eg: EFLAGS in x86</li>
</ul>
</li>
</ul>
<h4 id="linux-的-pcb">Linux 的 PCB<a class="headerlink" href="#linux-的-pcb" title="Permanent link">&para;</a></h4>
<p>Linux 中的进程控制块 PCB 源码位于 <code>linux-x.xx.xx/include/linux/sched.h</code></p>
<p>Linux 不区分进程和线程，将它们都视为 <code>task</code></p>
<p>由 C 结构 <code>task_struct</code> 表示：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="n">pid</span><span class="w"> </span><span class="n">t_pid</span><span class="err">；</span><span class="cm">/*进程标识符*/</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">time_slice</span><span class="w"> </span><span class="cm">/*调度信息*/</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">task_struct</span><span class="o">*</span><span class="w"> </span><span class="n">父进程</span><span class="err">；</span><span class="cm">/*此进程的父级*/</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">list_head</span><span class="w"> </span><span class="n">children</span><span class="err">；</span><span class="cm">/*此进程的子进程*/</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="o">*</span><span class="n">files</span><span class="err">；</span><span class="cm">/*打开文件列表*/</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">mm_struct</span><span class="o">*</span><span class="n">mm</span><span class="err">；</span><span class="cm">/*此进程的地址空间*/</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">  </span><span class="p">...</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">}</span>
</code></pre></div>
<p><img alt="task_struct" src="../../../assets/cs/os/process/task_struct.png" /></p>
<h3 id="进程的特征">进程的特征<a class="headerlink" href="#进程的特征" title="Permanent link">&para;</a></h3>
<ul>
<li>动态性——进程是程序的一次执行过程，是动态地产生、变化和消亡的（动态性是进程<strong>最基本</strong>的特征）</li>
<li>并发性——内存中有多个进程实体，各进程可并发执行</li>
<li>独立性——进程是能独立运行、独立获得资源、独立接受调度的基本单位</li>
<li>异步性——各进程按各自独立的、不可预知的速度向前推进，操作系统要提供“进程同步机制"来解决异步问题</li>
<li>结构性——每个进程都会配置一个 PCB。结构上看，进程由程序段、数据段、PCB 组成</li>
</ul>
<h2 id="进程的状态与转换">进程的状态与转换<a class="headerlink" href="#进程的状态与转换" title="Permanent link">&para;</a></h2>
<p>The steps in a full process switch are:</p>
<ol>
<li>save the context of the processor</li>
<li>update the PCB of the process currently in the Running state</li>
<li>move the PCB of this process to the appropriate queue</li>
<li>select another process for execution</li>
<li>update the PCB of the process selected</li>
<li>update memory management data structures</li>
<li>restore the context of the processor to that which existed at the time the selected process was last switched out</li>
</ol>
<h3 id="五状态模型">五状态模型<a class="headerlink" href="#五状态模型" title="Permanent link">&para;</a></h3>
<p><img alt="五状态模型" src="../../../assets/cs/os/process/%E4%BA%94%E7%8A%B6%E6%80%81%E6%A8%A1%E5%9E%8B.png" /></p>
<h3 id="七状态模型">七状态模型<a class="headerlink" href="#七状态模型" title="Permanent link">&para;</a></h3>
<p>增加了<strong>挂起</strong>状态的进程</p>
<hr />
<p>挂起进程的特征：</p>
<ul>
<li>
<p>进程不能立即执行（上处理机）</p>
</li>
<li>
<p>进程可能有也可能么有等待一个事件（为什么那么像废话）</p>
</li>
<li>
<p>为阻止该进程执行，可通过<strong>代理</strong>使其处于挂起状态；代理可以是：</p>
</li>
<li>
<p>进程本身</p>
</li>
<li>
<p>父进程</p>
</li>
<li>
<p>操作系统</p>
</li>
<li>
<p>只有代理程序显示地命令操作系统进行状态轮换，才能使该进程从挂起的状态转移</p>
</li>
</ul>
<hr />
<p>进程挂起的原因：</p>
<ul>
<li>Swaping</li>
<li>Other OS reason</li>
<li>Interactive user request</li>
<li>Timing</li>
<li>Parent pocess request</li>
</ul>
<hr />
<p>双挂起状态的进程模型：</p>
<p><img alt="七状态模型" src="../../../assets/cs/os/process/%E4%B8%83%E7%8A%B6%E6%80%81%E6%A8%A1%E5%9E%8B.png" /></p>
<h2 id="进程组织">进程组织<a class="headerlink" href="#进程组织" title="Permanent link">&para;</a></h2>
<p>进程组织的数据结构</p>
<h3 id="链接式组织进程">链接式组织进程<a class="headerlink" href="#链接式组织进程" title="Permanent link">&para;</a></h3>
<p><img alt="链式组织进程" src="../../../assets/cs/os/process/%E9%93%BE%E5%BC%8F%E7%BB%84%E7%BB%87%E8%BF%9B%E7%A8%8B.png" /></p>
<h3 id="索引式组织进程">索引式组织进程<a class="headerlink" href="#索引式组织进程" title="Permanent link">&para;</a></h3>
<p><img alt="索引式组织进程" src="../../../assets/cs/os/process/%E7%B4%A2%E5%BC%95%E5%BC%8F%E7%BB%84%E7%BB%87%E8%BF%9B%E7%A8%8B.png" /></p>
<h2 id="进程控制">进程控制<a class="headerlink" href="#进程控制" title="Permanent link">&para;</a></h2>
<p>也就是对进程的操作，这些基本操作几乎全部都是系统调用实现的</p>
<h3 id="系统调用">系统调用<a class="headerlink" href="#系统调用" title="Permanent link">&para;</a></h3>
<p>Some basic and important system calls</p>
<p>PCB 的访问：</p>
<p><img alt="getpid()" src="../../../assets/cs/os/process/getpid%28%29.png" /></p>
<ul>
<li><code>fork()</code></li>
<li><code>exec*()</code></li>
<li><code>wait()</code></li>
<li><code>exit()</code></li>
</ul>
<h4 id="linux-举例">Linux 举例<a class="headerlink" href="#linux-举例" title="Permanent link">&para;</a></h4>
<p>父进程创建子进程，子进程又创建其他进程，形成<strong>进程树</strong>；父子之间不同角度可能有不同关系：</p>
<ul>
<li>资源共享</li>
<li>父和子共享所有资源 (Linux 中父进程 <code>vfork</code>)</li>
<li>子进程共享父进程资源的子集 (Linux 中父进程 <code>vfork</code>)</li>
<li>父进程和子进程不共享任何资源 (Linux 中父进程 <code>fork</code>)</li>
<li>执行</li>
<li>父进程和子进程同时并发执行</li>
<li>父进程等待直到子进程终止 (Linux 中父进程 <code>wait(0)</code>)</li>
<li>地址空间</li>
<li>子进程是父进程的复制品 (Linux 中父进程 <code>fork</code>)</li>
<li>子进程加载另一个新的程序</li>
<li>子进程完全覆盖父进程 (Linux 中父进程 <code>fork</code>+<code>exec</code>)<ul>
<li><code>exec</code> family 有 6 个成员</li>
<li><code>execl</code> 装载新的文件</li>
</ul>
</li>
</ul>
<h5 id="fork"><code>fork</code><a class="headerlink" href="#fork" title="Permanent link">&para;</a></h5>
<p>Linux 中，由父进程调用系统调用 <code>fork()</code> 创建子进程</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="cp">#include</span><span class="cpf">&lt;unistd.h&gt;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">(){</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">){</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="n">fork</span><span class="p">();</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;This is a test printed by %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">getpid</span><span class="p">());</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="p">}</span>
</code></pre></div>
<p>编译运行上述程序将打印出 <strong>16</strong> 次！因为这里子进程是父进程的复制品：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>node1@vm1:~/Desktop$<span class="w"> </span>gcc<span class="w"> </span>-o<span class="w"> </span><span class="nb">test</span><span class="w"> </span>test.c
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>node1@vm1:~/Desktop$<span class="w"> </span>./test
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139377</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139382</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139380</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139379</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139378</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139383</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>node1@vm1:~/Desktop$<span class="w"> </span>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139381</span><span class="w"> </span><span class="c1">## 父进程结束</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139386</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139387</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139385</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139388</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139389</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139384</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139390</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139391</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span>printed<span class="w"> </span>by<span class="w"> </span><span class="m">139392</span>
</code></pre></div>
<p><code>fork</code> 会克隆的内容：</p>
<table>
<thead>
<tr>
<th>Cloned items</th>
<th>Descriptions</th>
</tr>
</thead>
<tbody>
<tr>
<td>Program code [File &amp; Memory]</td>
<td>They are sharing the same piece of code.</td>
</tr>
<tr>
<td>Memory</td>
<td>Including local variables, global variables, and dynamically allocated memory.</td>
</tr>
<tr>
<td>Opened files [Kernel's internal]</td>
<td>If the parent has opened a file "A", then the child will also have file "A" opened automatically.</td>
</tr>
<tr>
<td>Program counter [CPU register]</td>
<td>That's why they both execute from the same line of code after fork() returns.</td>
</tr>
</tbody>
</table>
<p><code>fork</code> 不克隆的内容：</p>
<table>
<thead>
<tr>
<th>Distinct items</th>
<th>Parent</th>
<th>Child</th>
</tr>
</thead>
<tbody>
<tr>
<td>Return value of fork() PID of the child process.</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>PID</td>
<td>Unchanged.</td>
<td>Different, not necessarily be "Parent PID + 1"</td>
</tr>
<tr>
<td>Parent process</td>
<td>Unchanged.</td>
<td>Doesn't have the same parent as that of the parent process.</td>
</tr>
<tr>
<td>Running time</td>
<td>Cumulated.</td>
<td>Just created, so should be 0.</td>
</tr>
</tbody>
</table>
<p><code>vfork</code> 函数是 <code>fork</code> 函数基础上的修正， <code>fork</code> 函数创建一个完全分离的进程，而 <code>vfork</code> 用于创建一个<strong>共享的进程</strong>，没有克隆操作，这意味着父进程子进程可以互相看到对方，共享同样的物理地址</p>
<h5 id="exec"><code>exec*</code><a class="headerlink" href="#exec" title="Permanent link">&para;</a></h5>
<p><code>exec*</code> 系统调用，会“鸠占鹊巢”，替换掉原进程的代码，但是 PID、父子关系、进程运行时间都不变，也就是：</p>
<ul>
<li>内核里的内容不变，包括 PCB 等</li>
<li>用户态里的代码被替换</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="cp">#include</span><span class="cpf">&lt;unistd.h&gt;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;before execl ...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 原进程代码可以执行</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="n">execl</span><span class="p">(</span><span class="s">&quot;/bin/ls&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/bin/ls&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"> </span><span class="c1">// exec 的一个成员函数</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;after execl ...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 原进程代码无法执行</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="p">}</span>
</code></pre></div>
<p>编译执行结果：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>node1@vm2:~/Desktop$<span class="w"> </span>gcc<span class="w"> </span>-o<span class="w"> </span><span class="nb">test</span><span class="w"> </span>test.c
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>node1@vm2:~/Desktop$<span class="w"> </span>./test
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>before<span class="w"> </span>execl<span class="w"> </span>...
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>sdb<span class="w">  </span>stack_rwx.c<span class="w">  </span><span class="nb">test</span><span class="w">  </span>test01<span class="w">  </span>test.c<span class="w">  </span>ysos
</code></pre></div>
<h5 id="wait和waitpid"><code>wait</code>和<code>waitpid</code><a class="headerlink" href="#wait和waitpid" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>wait()</th>
<th>waitpid()</th>
</tr>
</thead>
<tbody>
<tr>
<td>Wait for any one of the children.</td>
<td>Depending on the parameters, <code>waitpid()</code> will wait for a particular child only.</td>
</tr>
<tr>
<td>Detect child termination only.</td>
<td>Depending on the parameters, <code>waitpid()</code> can detect child's status changing: -from running to suspended, and -from suspended to running.</td>
</tr>
</tbody>
</table>
<h5 id="forkexec"><code>fork</code>+<code>exec*</code><a class="headerlink" href="#forkexec" title="Permanent link">&para;</a></h5>
<p>执行顺序是不确定的</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="cp">#include</span><span class="cpf">&lt;unistd.h&gt;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">system_test</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">cmd_str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">cmd_str</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">fork</span><span class="p">()</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">        </span><span class="n">execl</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span><span class="w"> </span><span class="n">cmd_str</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">&quot;%s: command not found</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cmd_str</span><span class="p">);</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="p">}</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;before...</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">    </span><span class="n">system_test</span><span class="p">(</span><span class="s">&quot;/bin/ls&quot;</span><span class="p">);</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">after...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="p">}</span>
</code></pre></div>
<p>编译执行结果：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>node1@vm2:~/Desktop$<span class="w"> </span>gcc<span class="w"> </span>-o<span class="w"> </span><span class="nb">test</span><span class="w"> </span>test.c
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>node1@vm2:~/Desktop$<span class="w"> </span>./test
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>before...
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>after...
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>sdb<span class="w">  </span>stack_rwx.c<span class="w">  </span><span class="nb">test</span><span class="w">  </span>test01<span class="w">  </span>test.c<span class="w">  </span>ysos<span class="w"> </span><span class="c1">## 执行 ls</span>
</code></pre></div>
<p>类似于一个 shell 或 <code>system</code>，不过 <code>system</code> 创建子进程，时串行执行，执行顺序是确定的。</p>
<h5 id="forkexecwait"><code>fork</code>+<code>exec*</code>+<code>wait</code><a class="headerlink" href="#forkexecwait" title="Permanent link">&para;</a></h5>
<p>等价于 <code>system</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="cp">#include</span><span class="cpf">&lt;unistd.h&gt;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">system_test</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">cmd_str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cmd_str</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">fork</span><span class="p">()</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">        </span><span class="n">execl</span><span class="p">(</span><span class="s">&quot;/bin/sh&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/bin/sh&quot;</span><span class="p">,</span><span class="s">&quot;-c&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cmd_str</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">&quot;%s: command not found</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cmd_str</span><span class="p">);</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">    </span><span class="n">wait</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="p">}</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">    </span><span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;before...</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"> </span><span class="n">system_test</span><span class="p">(</span><span class="s">&quot;/bin/1s&quot;</span><span class="p">);</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">after...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="p">}</span>
</code></pre></div>
<p>编译执行结果：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>node1@vm2:~/Desktop$<span class="w"> </span>gcc<span class="w"> </span>-o<span class="w"> </span><span class="nb">test</span><span class="w"> </span>test.c
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>node1@vm2:~/Desktop$<span class="w"> </span>./test
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>before...
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>sdb<span class="w">  </span>stack_rwx.c<span class="w">  </span><span class="nb">test</span><span class="w">  </span>test01<span class="w">  </span>test.c<span class="w">  </span>ysos
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>after...
</code></pre></div>
<h5 id="exit"><code>exit</code><a class="headerlink" href="#exit" title="Permanent link">&para;</a></h5>
<p>父进程 <code>wait</code> 和子进程 <code>exit</code> 搭配食用。子进程执行最后一条语句，然后调用 <code>exit</code> 系统调用请求操作系统删除它自己，然后子进程将发送 <code>SIGCHLD</code> 给父进程，并变<strong>僵尸进程</strong>；父进程接收到 <code>SIGCHLD</code> 后被唤醒（原本被 <code>wait</code> 休眠），处理 <code>SIGCHLD</code> 之后，子进程才被彻底销毁。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="cp">#include</span><span class="cpf">&lt;unistd.h&gt;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="cp">#include</span><span class="cpf">&lt;stdlib.h&gt;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="kt">pid_t</span><span class="w"> </span><span class="n">childpid</span><span class="p">,</span><span class="w"> </span><span class="n">terminatedid</span><span class="p">;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="n">childpid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fork</span><span class="p">();</span><span class="w"> </span><span class="cm">/* child duplicates parent’s address space */</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">childpid</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">        </span><span class="n">perror</span><span class="p">(</span><span class="s">&quot;fork()&quot;</span><span class="p">);</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">childpid</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* This is child pro */</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">        </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;child pro pid = %d, count = %d (addr = %p)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">getpid</span><span class="p">(),</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">count</span><span class="p">);</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;child sleeping ...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">        </span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"> </span><span class="cm">/* parent wait() during this period */</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">child waking up!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* This is parent pro */</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">        </span><span class="n">terminatedid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wait</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;parent pro pid = %d, terminated pid = %d, count = %d (addr = %p)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">        </span><span class="n">getpid</span><span class="p">(),</span><span class="w"> </span><span class="n">terminatedid</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">count</span><span class="p">);</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Testing point by %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">getpid</span><span class="p">());</span><span class="w"> </span><span class="cm">/* executed by child and parent */</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="p">}</span>
</code></pre></div>
<p>编译运行结果：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>node1@vm2:~/Desktop$<span class="w"> </span>./test
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>child<span class="w"> </span>pro<span class="w"> </span><span class="nv">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">197382</span>,<span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">(</span><span class="nv">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x7ffc33c444cc<span class="o">)</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>child<span class="w"> </span>sleeping<span class="w"> </span>...
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="c1">## 这里等待了 5 秒钟</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>child<span class="w"> </span>waking<span class="w"> </span>up!
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>Testing<span class="w"> </span>point<span class="w"> </span>by<span class="w"> </span><span class="m">197382</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>parent<span class="w"> </span>pro<span class="w"> </span><span class="nv">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">197381</span>,<span class="w"> </span>terminated<span class="w"> </span><span class="nv">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">197382</span>,<span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span><span class="nv">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x7ffc33c444cc<span class="o">)</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>Testing<span class="w"> </span>point<span class="w"> </span>by<span class="w"> </span><span class="m">197381</span>
</code></pre></div>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p><strong>僵尸进程</strong>：空有 PCB “外壳”，但是没有用户态的代码，无法执行；</p>
</div>
<p>注意区分孤儿进程</p>
<h5 id="abort"><code>abort</code><a class="headerlink" href="#abort" title="Permanent link">&para;</a></h5>
<p>父进程可以使用 <code>abort</code> 系统调用终止子进程的执行。这样做的一些原因：</p>
<ul>
<li>子进程已超出分配的资源</li>
<li>不再需要分配给子进程的任务</li>
<li>父进程正在退出，如果父进程终止，操作系统不允许子进程继续</li>
</ul>
<h3 id="进程控制原语">进程控制原语<a class="headerlink" href="#进程控制原语" title="Permanent link">&para;</a></h3>
<p>进程控制由<strong>原语</strong>实现</p>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p>如果不能像原语“一气呵成”，就有可能导致操作系统中的某些关键数据结构信息不统一的情况，这会影响操作系统进行别的管理工作</p>
</div>
<p>原语的执行具有原子性，即执行过程只能一气呵成，期间不允许被中断。</p>
<p>可以用 <strong>“关中断指令”</strong> 和 <strong>“开中断指令”</strong> 这两个<strong>特权指令</strong>实现原子性</p>
<p>无论哪个进程控制原语，要做的无非三类事情：</p>
<ul>
<li>更新 PCB 中的信息</li>
<li>修改进程状态（state）</li>
<li>保存/恢复运行环境</li>
<li>将 PCB 插入合适的队列</li>
<li>分配/回收资源</li>
</ul>
<h3 id="创建">创建<a class="headerlink" href="#创建" title="Permanent link">&para;</a></h3>
<ul>
<li>申请空白 PCB</li>
<li>为新进程分配所需资源</li>
<li>初始化 PCB</li>
<li>将 PCB 插入就绪队列（进程由<strong>阻塞态</strong>转变为<strong>就绪态</strong>）</li>
</ul>
<p>引起进程创建的事件可能有：</p>
<ul>
<li>用户登录——分时系统中，用户登录成功，系统会建立为其建立一个新的进程</li>
<li>作业调度——多道批处理系统中，有新的作业放入内存时，会为其建立一个新的进程</li>
<li>提供服务——用户向操作系统提出某些请求时，会新建一个进程处理该请求</li>
<li>应用请求——由用户进程主动请求创建一个子进程</li>
</ul>
<p>所有进程都是以<strong>父进程创建子进程</strong>的方式创建的：</p>
<ul>
<li>有些是显式的</li>
<li>用户进程创建的</li>
<li>有些是隐式的</li>
<li>操作系统 “0 号” 根进程创建的（所有进程的祖先）</li>
</ul>
<h4 id="根进程">根进程<a class="headerlink" href="#根进程" title="Permanent link">&para;</a></h4>
<p>The first process -- The kernel, while it is booting up, creates the firstprocess -- <code>init</code>.</p>
<p>The <code>init</code> process:</p>
<ul>
<li>has PID = 1</li>
<li>and is running the program code “/sbin/init”.</li>
<li>Its first task is to create more processes...</li>
</ul>
<h4 id="孤儿进程">孤儿进程<a class="headerlink" href="#孤儿进程" title="Permanent link">&para;</a></h4>
<p>父进程创建子进程一层一层创建，但若其中某一个父进程 terminate 了，也就是被终止了，那么被终止进程所创建的进程就变成了<strong>孤儿进程</strong>。孤儿进程会消耗资源，需要被重新管理起来。</p>
<ul>
<li>Linux 中，使用 re-parent operation 处理孤儿进程， The “init” process will become the step-mother of all orphans.</li>
<li>Windows maintains a forest-like hierarchy.</li>
</ul>
<h3 id="撤销">撤销<a class="headerlink" href="#撤销" title="Permanent link">&para;</a></h3>
<p>这一过程进程： 就绪态/阻塞态/运行态 -&gt; 终止态 -&gt; 无</p>
<ul>
<li>从 PCB 集合中找到终止进程的 PCB</li>
<li>若进程正在运行，立即剥夺 CPU，将 CPU 分配给其他进程</li>
<li>终止其所有子进程</li>
<li>将该进程拥有的所有资源归还给父进程或操作系统</li>
<li>删除 PCB</li>
</ul>
<p>引起进程终止的事件可能有：</p>
<ul>
<li>正常结束——进程自己请求终止（exit 系统调用）</li>
<li>异常结束——被操作系统强行杀掉</li>
<li>整数除以 O</li>
<li>非法使用特权指令</li>
<li>外界干预——用户选择杀掉进程</li>
<li>Ctrl+Alt+delete</li>
<li>kill pid</li>
</ul>
<h3 id="阻塞">阻塞<a class="headerlink" href="#阻塞" title="Permanent link">&para;</a></h3>
<ul>
<li>找到要阻塞的进程对应的 PCB</li>
<li>保护进程运行现场，将 PCB 状态信息设置为“阻塞态"，暂时停止进程运行</li>
<li>将 PCB 插入相应事件的等待队列</li>
</ul>
<p>引起进程阻塞的事件可能有：</p>
<ul>
<li>需要等待系统分配某种资源</li>
<li>需要等待相互合作的其他进程完成工作</li>
</ul>
<h3 id="唤醒">唤醒<a class="headerlink" href="#唤醒" title="Permanent link">&para;</a></h3>
<ul>
<li>在事件等待队列中找到 PCB</li>
<li>将 PCB 从等待队列移除，设置进程为就绪态</li>
<li>将 PCB 插入就绪队列，等待被调度</li>
</ul>
<p>引起进程唤醒的事件可能有：</p>
<ul>
<li>等待的事件发生</li>
</ul>
<h3 id="切换">切换<a class="headerlink" href="#切换" title="Permanent link">&para;</a></h3>
<ul>
<li>将运行环境信息存入 PCB</li>
<li>PCB 移入相应队列</li>
<li>选择另一个进程执行，并更新其 PCB</li>
<li>根据 PCB 恢复新进程所需的运行环境</li>
</ul>
<p>系统切换：</p>
<p><img alt="系统切换" src="../../../assets/cs/os/process/%E7%B3%BB%E7%BB%9F%E5%88%87%E6%8D%A2.png" /></p>
<p>引起进程切换的事件可能有：</p>
<ul>
<li>当前进程时间片到</li>
<li>有更高优先级的进程到达</li>
<li>当前进程主动阻塞</li>
<li>当前进程终止</li>
</ul>
<h2 id="进程通信">进程通信<a class="headerlink" href="#进程通信" title="Permanent link">&para;</a></h2>
<p>进程间通信（Inter-Process Communication, <strong>IPC</strong>）是指两个进程之间产生数据交互。</p>
<p><img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" />为什么需要进程通信：</p>
<ul>
<li>进程是分配系统资源的单位（包括内存地址空间），因此各进程拥有的内存地址空间相互独立</li>
<li>为了保证安全，一个进程不能直接访问另一个进程的地址空间</li>
<li>多核处理器系统中，消息传递优于共享内存，因为<strong>没有 cache 的一致性问题</strong></li>
</ul>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p>Linux 的 IPC 限制信息可在 <code>/etc/sysctl.conf</code> 中查看</p>
</div>
<p><code>ipcs</code> 可以查看当前操作系统里有多少消息队列、共享内存块、信号量</p>
<ul>
<li>低级通信</li>
<li>共享文件，信号量 PV 操作</li>
<li>高级通信——以较高的效率传输大量数据</li>
<li>共享内存</li>
<li>消息传递</li>
<li>管道通信</li>
</ul>
<h3 id="共享存储">共享存储<a class="headerlink" href="#共享存储" title="Permanent link">&para;</a></h3>
<p>为避免出错，各个进程对共享空间的访问应该是<strong>互斥</strong>的</p>
<h4 id="基于存储区共享">基于存储区共享<a class="headerlink" href="#基于存储区共享" title="Permanent link">&para;</a></h4>
<p>操作系统在内存中划出一块共享存储区，数据的形式、存放位置都由<strong>通信进程</strong>控制，而不是操作系统。这种共享方式<strong>速度很快</strong>，是一种<strong>高级</strong>通信方式</p>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p>通过“增加页表项/段表项”即可将同一片共享内存区映射到各个进程的地址空间中</p>
</div>
<h5 id="linux-共享内存">Linux 共享内存<a class="headerlink" href="#linux-共享内存" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1">// shm 即 share memory 的缩写</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kt">int</span><span class="w"> </span><span class="nf">shm_open</span><span class="w"> </span><span class="p">(...);</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="c1">// 通过 shm_open 系统调用，申请一片共享内存区</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">mmap</span><span class="w"> </span><span class="p">(...);</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="c1">// 通过 mmap 系统调用，将共享内存区映射到进程自己的地址空间</span>
</code></pre></div>
<h6 id="key-id">Key ID<a class="headerlink" href="#key-id" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/shm.h&gt;</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="kt">key_t</span><span class="w"> </span><span class="nf">ftok</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">pathname</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="cm">/* key_t is of type int. ftok() convert a pathname and a project identifie</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="cm">to an IPC key */</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="kt">key_t</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ftok</span><span class="p">(</span><span class="err">“</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">myshm</span><span class="s">&quot;, 0x27);</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="k">if</span><span class="p">((</span><span class="n">key</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="n">perror</span><span class="p">(</span><span class="err">“</span><span class="n">ftok</span><span class="p">()</span><span class="s">&quot;);</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;key = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>
</code></pre></div>
<h6 id="create">Create<a class="headerlink" href="#create" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">shmget</span><span class="p">(</span><span class="kt">key_t</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">shmflg</span><span class="p">);</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="cm">/* shmget() allocates a shared memory segment */</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="cm">/* upper bound of size: 1.9G */</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="kt">int</span><span class="w"> </span><span class="n">shmid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shmget</span><span class="p">(</span><span class="n">IPC_PRIVATE</span><span class="p">,</span><span class="w"> </span><span class="mi">4096</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_CREATE</span><span class="o">|</span><span class="n">IPC_EXCL</span><span class="o">|</span><span class="mo">0660</span><span class="p">);</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="k">if</span><span class="p">(</span><span class="n">shmid</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">  </span><span class="n">perror</span><span class="p">(</span><span class="s">&quot;shmget()&quot;</span><span class="p">);</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="p">}</span>
</code></pre></div>
<h4 id="基于数据结构的共享">基于数据结构的共享<a class="headerlink" href="#基于数据结构的共享" title="Permanent link">&para;</a></h4>
<p>比如共享空间里只能放一个长度为 10 的数组。这种共享方式<strong>速度慢</strong>、<strong>限制多</strong>，是一种<strong>低级</strong>通信方式</p>
<h3 id="消息传递">消息传递<a class="headerlink" href="#消息传递" title="Permanent link">&para;</a></h3>
<p>进程间的数据交换以<strong>格式化的消息</strong>（Message）单位。进程通过操作系统提供的两个原语进行数据交换：</p>
<ul>
<li>发送原语，<code>send(X, msg)</code>，X 是发送目标</li>
<li>接收消息，<code>receive(X, &amp;msg)</code> ，X 是从哪里接收</li>
</ul>
<p><strong>格式化的消息</strong>（Message）的结构：</p>
<ul>
<li>消息头</li>
<li>发送进程 ID</li>
<li>接受进程 ID</li>
<li>消息长度等格式化的信息</li>
<li>消息体</li>
</ul>
<h4 id="直接通信方式">直接通信方式<a class="headerlink" href="#直接通信方式" title="Permanent link">&para;</a></h4>
<p>P 传递消息给 Q 的过程：</p>
<ul>
<li>P 发送原语 <code>send(Q, msg)</code></li>
<li><code>msg</code> 数据被封装为格式化消息</li>
<li>格式化消息被从 <strong>P 的地址空间</strong>转移到<strong>操作系统内核的地址空间</strong>中进程 <strong>Q 的消息队列</strong></li>
<li>Q 接收原语 <code>receive(P, &amp;msg)</code></li>
<li>格式化消息被从<strong>操作系统内核的地址空间</strong>中进程 <strong>Q 的消息队列</strong>转移到 <strong>Q 的地址空间</strong></li>
<li>解析格式化的消息</li>
</ul>
<p>特性：</p>
<ul>
<li>链接是自动建立的</li>
<li>链路仅与一对通信进程相关联</li>
<li>每对之间只存在一个链接</li>
<li>链路可能是单向的，但通常是双向的</li>
</ul>
<p>这种通信方式展示了寻址的<strong>对称性</strong>，即发送和接收进程必须指定对方，以便通信。</p>
<p>也可以采用寻址的<strong>非对称性</strong>，即只要发送者指定接收者，而接收者不需要指定发送者</p>
<h4 id="间接通信方式">间接通信方式<a class="headerlink" href="#间接通信方式" title="Permanent link">&para;</a></h4>
<p>以“信箱”（或某些特定的端口）作为中间实体进行消息传递，可以多个进程往同一个信箱 send 消息，也可以多个进程从同一个信箱中 receive 消息；</p>
<p>每个邮箱都有一个唯一的 id ，进程只有在共享邮箱时才能通信；</p>
<p>允许链接最多与两个进程关联</p>
<p>一次只允许一个进程执行接收操作</p>
<p>允许系统任意选择接收器。通知发送方接收者是谁。</p>
<p><img alt="间接通信" src="../../../assets/cs/os/process/%E9%97%B4%E6%8E%A5%E9%80%9A%E4%BF%A1.png" /></p>
<p>P 传递消息给 Q 的过程：</p>
<ul>
<li>（创建邮箱）</li>
<li>P 发送原语 <code>send(A, msg)</code> ，发送给信箱 A</li>
<li><code>msg</code> 数据被封装为格式化消息</li>
<li>格式化消息被从 <strong>P 的地址空间</strong>转移到<strong>操作系统内核的地址空间</strong>中信箱 A 中</li>
<li>Q 接收原语 <code>receive(A, &amp;msg)</code> ，从信箱 A 接收消息</li>
<li>格式化消息被从<strong>操作系统内核的地址空间</strong>中信箱 A 转移到 <strong>Q 的地址空间</strong></li>
<li>解析格式化的消息</li>
<li>（删除邮箱）</li>
</ul>
<p>特性：</p>
<ul>
<li>仅当进程共享公共邮箱时才建立链接</li>
<li>链接可能与许多进程相关联</li>
<li>每对进程可以共享多个通信链路</li>
<li>链路可以是单向的或双向的</li>
</ul>
<p>邮箱所有者：</p>
<ul>
<li>邮箱可以被进程拥有；</li>
<li>邮箱被操作系统拥有；</li>
<li>邮箱可以转移</li>
</ul>
<h4 id="同步异步">同步/异步<a class="headerlink" href="#同步异步" title="Permanent link">&para;</a></h4>
<p>消息传递可以是阻塞的，也可以是非阻塞的</p>
<ul>
<li>阻塞被认为是同步的</li>
<li>阻塞发送—在接收进程或者邮箱收到消息之前，发送进程阻塞；</li>
<li>Blocking receive（阻塞接收）——在消息可用之前，接收进程将被阻塞</li>
<li>非阻塞被认为是异步的</li>
<li>非阻塞发送——发送进程发送消息并继续执行；</li>
<li>非阻塞接收——接收进程接收：<ul>
<li>有效消息</li>
<li>或空消息</li>
</ul>
</li>
<li>可能有不同的组合</li>
<li>如果发送和接收都是阻塞的，双方之间有一个交会。</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>与其他课程的阻塞、同步异步关系可能不太一样</p>
</div>
<h4 id="缓存">缓存<a class="headerlink" href="#缓存" title="Permanent link">&para;</a></h4>
<p>附加到链接的消息队列，不管通信是直接还是间接的；以三种方式之一实现队列：</p>
<ul>
<li>1.零容量–链路上没有消息排队。发送方必须等待接收方</li>
<li>2.有限容量–有限长度的 n 条消息，如果链路已满，则发送者必须等待</li>
<li>3.无限容量–无限长，发送方从不等待</li>
</ul>
<h4 id="linux-接口实现">Linux 接口实现<a class="headerlink" href="#linux-接口实现" title="Permanent link">&para;</a></h4>
<p><code>msgdata.h</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="cp">#define TEXT_SIZE 512</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="cm">/* considering</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="cm">------ Messages Limits --------</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="cm">max queues system wide = 32000</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="cm">max size of message (bytes) = 8192</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="cm">default max size of queue (bytes) = 16384</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="cm">------------------------------------------</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="cm">The size of message is set to be 512, the total number of messages is 16384/512 = 32</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="cm">If we take the max size 8192, the number would be 16384/8192 = 2. It is not reasonable</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="cm">*/</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="cm">/* message structure */</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="k">struct</span><span class="w"> </span><span class="nc">msg_struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="kt">long</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">msg_type</span><span class="p">;</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="kt">char</span><span class="w"> </span><span class="n">mtext</span><span class="p">[</span><span class="n">TEXT_SIZE</span><span class="p">];</span><span class="w"> </span><span class="cm">/* binary data */</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="p">};</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="cp">#define PERM S_IRUSR|S_IWUSR|IPC_CREAT</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="cp">#define ERR_EXIT(m) \</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="cp">  do { \</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="cp">    perror(m); \</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="cp">    exit(EXIT_FAILURE); \</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="cp">  } while(0)</span>
</code></pre></div>
<p><code>msgsnd.c</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/msg.h&gt;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/stat.h&gt;</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fcntl.h&gt;</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;msgdata.h&quot;</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="p">{</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">msg_struct</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">msg_type</span><span class="p">;</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">TEXT_SIZE</span><span class="p">],</span><span class="w"> </span><span class="n">pathname</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">msqid</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">  </span><span class="kt">key_t</span><span class="w"> </span><span class="n">key</span><span class="p">;</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">  </span><span class="kt">FILE</span><span class="w"> </span><span class="o">*</span><span class="n">fp</span><span class="p">;</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">stat</span><span class="w"> </span><span class="n">fileattr</span><span class="p">;</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: ./a.out pathname</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">  </span><span class="n">strcpy</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">stat</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fileattr</span><span class="p">)</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">creat</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDWR</span><span class="p">);</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">        </span><span class="n">ERR_EXIT</span><span class="p">(</span><span class="s">&quot;creat()&quot;</span><span class="p">);</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;shared file object created</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w">  </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ftok</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span><span class="w"> </span><span class="mh">0x27</span><span class="p">);</span><span class="w"> </span><span class="cm">/* project_id can be any nonzero integer */</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="w">    </span><span class="n">ERR_EXIT</span><span class="p">(</span><span class="s">&quot;ftok()&quot;</span><span class="p">);</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">IPC key = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="w">  </span><span class="n">msqid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msgget</span><span class="p">((</span><span class="kt">key_t</span><span class="p">)</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="mo">0666</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">IPC_CREAT</span><span class="p">);</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">msqid</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="w">    </span><span class="n">ERR_EXIT</span><span class="p">(</span><span class="s">&quot;msgget()&quot;</span><span class="p">);</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="w">  </span><span class="n">fp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="s">&quot;./msgsnd.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rb&quot;</span><span class="p">);</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">fp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="w">    </span><span class="n">ERR_EXIT</span><span class="p">(</span><span class="s">&quot;source data file: ./msgsnd.txt fopen()&quot;</span><span class="p">);</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">msqid_ds</span><span class="w"> </span><span class="n">msqattr</span><span class="p">;</span>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msgctl</span><span class="p">(</span><span class="n">msqid</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_STAT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">msqattr</span><span class="p">);</span>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;number of messages remainded = %ld, empty slots = %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a><span class="w">  </span><span class="n">msqattr</span><span class="p">.</span><span class="n">msg_qnum</span><span class="p">,</span><span class="w"> </span><span class="mi">16384</span><span class="o">/</span><span class="n">TEXT_SIZE</span><span class="o">-</span><span class="n">msqattr</span><span class="p">.</span><span class="n">msg_qnum</span><span class="p">);</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Blocking Sending ... </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fscanf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%ld %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">msg_type</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">);</span>
<a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="n">EOF</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%ld %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg_type</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">);</span>
<a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a><span class="w">    </span><span class="n">data</span><span class="p">.</span><span class="n">msg_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msg_type</span><span class="p">;</span>
<a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a><span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">mtext</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">);</span>
<a id="__codelineno-15-55" name="__codelineno-15-55" href="#__codelineno-15-55"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msgsnd</span><span class="p">(</span><span class="n">msqid</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT_SIZE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-15-56" name="__codelineno-15-56" href="#__codelineno-15-56"></a><span class="w">    </span><span class="cm">/* 0: blocking send, waiting when msg queue is full */</span>
<a id="__codelineno-15-57" name="__codelineno-15-57" href="#__codelineno-15-57"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-58" name="__codelineno-15-58" href="#__codelineno-15-58"></a><span class="w">        </span><span class="n">ERR_EXIT</span><span class="p">(</span><span class="s">&quot;msgsnd()&quot;</span><span class="p">);</span>
<a id="__codelineno-15-59" name="__codelineno-15-59" href="#__codelineno-15-59"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-60" name="__codelineno-15-60" href="#__codelineno-15-60"></a><span class="w">    </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-15-61" name="__codelineno-15-61" href="#__codelineno-15-61"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-15-62" name="__codelineno-15-62" href="#__codelineno-15-62"></a><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;number of sent messages = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<a id="__codelineno-15-63" name="__codelineno-15-63" href="#__codelineno-15-63"></a><span class="w">  </span><span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<a id="__codelineno-15-64" name="__codelineno-15-64" href="#__codelineno-15-64"></a><span class="w">  </span><span class="n">system</span><span class="p">(</span><span class="s">&quot;ipcs -q&quot;</span><span class="p">);</span>
<a id="__codelineno-15-65" name="__codelineno-15-65" href="#__codelineno-15-65"></a><span class="w">  </span><span class="n">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
<a id="__codelineno-15-66" name="__codelineno-15-66" href="#__codelineno-15-66"></a><span class="p">}</span>
</code></pre></div>
<p><code>msgrcv.c</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/msg.h&gt;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/stat.h&gt;</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;msgdata.h&quot;</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="p">{</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">  </span><span class="kt">key_t</span><span class="w"> </span><span class="n">key</span><span class="p">;</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">stat</span><span class="w"> </span><span class="n">fileattr</span><span class="p">;</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">pathname</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">msqid</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">msg_struct</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">msgtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="cm">/* 0 - type of any messages */</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: ./msgrcv pathname msg_type</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="w">  </span><span class="n">strcpy</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">stat</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fileattr</span><span class="p">)</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="w">    </span><span class="n">ERR_EXIT</span><span class="p">(</span><span class="s">&quot;shared file object stat error&quot;</span><span class="p">);</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="w">  </span><span class="k">if</span><span class="p">((</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ftok</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span><span class="w"> </span><span class="mh">0x27</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="w">    </span><span class="n">ERR_EXIT</span><span class="p">(</span><span class="s">&quot;ftok()&quot;</span><span class="p">);</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">IPC key = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="w">  </span><span class="n">msqid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msgget</span><span class="p">((</span><span class="kt">key_t</span><span class="p">)</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="mo">0666</span><span class="p">);</span><span class="w"> </span><span class="cm">/* do not create a new msg queue */</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">msqid</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="w">    </span><span class="n">ERR_EXIT</span><span class="p">(</span><span class="s">&quot;msgget()&quot;</span><span class="p">);</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a><span class="w">    </span><span class="n">msgtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a><span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a><span class="w">    </span><span class="n">msgtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atol</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">msgtype</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a><span class="w">            </span><span class="n">msgtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="cm">/* determin msgtype (class number) */</span>
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Selected message type = %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msgtype</span><span class="p">);</span>
<a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msgrcv</span><span class="p">(</span><span class="n">msqid</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT_SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">msgtype</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_NOWAIT</span><span class="p">);</span>
<a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a><span class="w">    </span><span class="cm">/* Non_blocking receive */</span>
<a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* end of this msgtype */</span>
<a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;number of received messages = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%ld %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">msg_type</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">mtext</span><span class="p">);</span>
<a id="__codelineno-16-49" name="__codelineno-16-49" href="#__codelineno-16-49"></a><span class="w">    </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-16-50" name="__codelineno-16-50" href="#__codelineno-16-50"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-51" name="__codelineno-16-51" href="#__codelineno-16-51"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">msqid_ds</span><span class="w"> </span><span class="n">msqattr</span><span class="p">;</span>
<a id="__codelineno-16-52" name="__codelineno-16-52" href="#__codelineno-16-52"></a><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msgctl</span><span class="p">(</span><span class="n">msqid</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_STAT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">msqattr</span><span class="p">);</span>
<a id="__codelineno-16-53" name="__codelineno-16-53" href="#__codelineno-16-53"></a><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;number of messages remainding = %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msqattr</span><span class="p">.</span><span class="n">msg_qnum</span><span class="p">);</span>
<a id="__codelineno-16-54" name="__codelineno-16-54" href="#__codelineno-16-54"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">msqattr</span><span class="p">.</span><span class="n">msg_qnum</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-55" name="__codelineno-16-55" href="#__codelineno-16-55"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;do you want to delete this msg queue?(y/n)&quot;</span><span class="p">);</span>
<a id="__codelineno-16-56" name="__codelineno-16-56" href="#__codelineno-16-56"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getchar</span><span class="p">()</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="sc">&#39;y&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-57" name="__codelineno-16-57" href="#__codelineno-16-57"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">msgctl</span><span class="p">(</span><span class="n">msqid</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_RMID</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<a id="__codelineno-16-58" name="__codelineno-16-58" href="#__codelineno-16-58"></a><span class="w">        </span><span class="n">perror</span><span class="p">(</span><span class="s">&quot;msgctl(IPC_RMID)&quot;</span><span class="p">);</span>
<a id="__codelineno-16-59" name="__codelineno-16-59" href="#__codelineno-16-59"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-60" name="__codelineno-16-60" href="#__codelineno-16-60"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-61" name="__codelineno-16-61" href="#__codelineno-16-61"></a><span class="w">  </span><span class="n">system</span><span class="p">(</span><span class="s">&quot;ipcs -q&quot;</span><span class="p">);</span>
<a id="__codelineno-16-62" name="__codelineno-16-62" href="#__codelineno-16-62"></a><span class="w">  </span><span class="n">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
<a id="__codelineno-16-63" name="__codelineno-16-63" href="#__codelineno-16-63"></a><span class="p">}</span>
</code></pre></div>
<h4 id="posixpthread实现">POSIX(pthread)实现<a class="headerlink" href="#posixpthread实现" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mqueue.h&gt;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="cp">## Open, Close and Unlink</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="n">mqd_t</span><span class="w"> </span><span class="nf">mq_open</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">oflag</span><span class="p">,</span><span class="w"> </span><span class="kt">mode_t</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">mq_attr</span><span class="w"> </span><span class="o">*</span><span class="n">attr</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="cm">/* return the mqdes, or -1 if failed */</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="n">mqd_t</span><span class="w"> </span><span class="n">mqID</span><span class="p">;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="n">mqID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mq_open</span><span class="p">(</span><span class="s">&quot;/anonymQueue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDWR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_CREAT</span><span class="p">,</span><span class="w"> </span><span class="mo">0666</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="n">mqd_t</span><span class="w"> </span><span class="nf">mq_close</span><span class="p">(</span><span class="n">mqd_t</span><span class="w"> </span><span class="n">mqdes</span><span class="p">);</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="n">mqd_t</span><span class="w"> </span><span class="nf">mq_unlink</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">);</span><span class="w"> </span><span class="cm">/* return -1 if failed */</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="cp">## Send and Receive</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="n">mqd_t</span><span class="w"> </span><span class="nf">mq_send</span><span class="p">(</span><span class="n">mqd_t</span><span class="w"> </span><span class="n">mqdes</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">msg_ptr</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">msg_len</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">msg_prio</span><span class="p">);</span><span class="w"> </span><span class="cm">/* return 0, or -1 if failed */</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="n">mq_send</span><span class="p">(</span><span class="n">mqID</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="n">mqd_t</span><span class="w"> </span><span class="n">mq_receive</span><span class="p">(</span><span class="n">mqd_t</span><span class="w"> </span><span class="n">mqdes</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">msg_ptr</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">msg_len</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="o">*</span><span class="n">msg_prio</span><span class="p">);</span><span class="w"> </span><span class="cm">/* return the number of char received, or -1 if failed */</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="n">mq_attr</span><span class="w"> </span><span class="n">mqAttr</span><span class="p">;</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="n">mq_getattr</span><span class="p">(</span><span class="n">mqID</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mqAttr</span><span class="p">);</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="n">mq_receive</span><span class="p">(</span><span class="n">mqID</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">mqAttr</span><span class="p">.</span><span class="n">mq_msgsize</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
</code></pre></div>
<p>Note that the Linux ipcs utility is not fully compatible to the POSIX ipcs utility. The message queues, shared memory and semaphores in POSIX can not be sensed by System V bash command such as <code>ipcs -q</code></p>
<h4 id="mach">Mach<a class="headerlink" href="#mach" title="Permanent link">&para;</a></h4>
<p>Mach 作为微内核结构，其通信是基于消息传递的设计，甚至系统调用也是消息传递</p>
<ul>
<li>每个任务在创建时获得两个端口-内核和通知</li>
<li>使用 <code>mach_msg()</code> 函数发送和接收消息</li>
<li>通信所需的端口，通过创建 mach 端口分配</li>
<li>收发灵活；例如，邮箱已满时有四个选项：</li>
<li>无限期地等待</li>
<li>最多等待 n 毫秒</li>
<li>立即返回</li>
<li>临时缓存消息</li>
</ul>
<h4 id="windows">Windows<a class="headerlink" href="#windows" title="Permanent link">&para;</a></h4>
<p>通过高级本地过程调用（ALPC）设施以消息传递为中心，仅在同一系统上的两个进程之间工作，类似 RPC；</p>
<ul>
<li>使用端口（如邮箱）建立和维护通信通道；</li>
<li>使用两种类型的端口：</li>
<li>连接端口</li>
<li>通信端口</li>
</ul>
<p>通讯工作如下：</p>
<ul>
<li>客户端打开子系统连接端口对象的句柄；</li>
<li>客户端发送一个连接请求；</li>
<li>服务器创建一对专用通信端口，并将其中一个端口的句柄返回给客户端；</li>
<li>客户端和服务器使用相应的端口句柄发送消息或回调，并监听回复；</li>
</ul>
<p><img alt="windows消息传递" src="../../../assets/cs/os/process/windows%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92.png" /></p>
<p>Windows 对不同大小的消息有不同的策略；When an ALPC channel is created, one of three message-passing techniques is chosen:</p>
<ol>
<li>
<p>For small messages (up to 256 bytes), the port’s message queue is used as intermediate storage, and the messages are copied from one process to the other.</p>
</li>
<li>
<p>Larger messages must be passed through a section object, which is a region of shared memory associated with the channel.</p>
</li>
<li>
<p>When the amount of data is too large to fit into a section object, an API is available that allows server processes to read and write directly into the address space of a client.</p>
</li>
</ol>
<h3 id="管道通信">管道通信<a class="headerlink" href="#管道通信" title="Permanent link">&para;</a></h3>
<p>“管道”是一个<strong>特殊的共享文件</strong>，又名<strong>pipe 文件</strong>。其实就是在内存中开辟一个<strong>大小固定的内存缓冲区</strong>。</p>
<ul>
<li>普通管道(匿名管道)——无法从创建它的进程外部访问。通常，父进程创建管道并使用它与它创建的子进程通信。是<strong>单向</strong>的、<strong>半双工</strong>的。
  <img alt="普通管道" src="../../../assets/cs/os/process/%E6%99%AE%E9%80%9A%E7%AE%A1%E9%81%93.png" /></li>
<li>命名管道——可以在没有父子关系的情况下访问。是<strong>双向的</strong>、<strong>全双工</strong>的。</li>
</ul>
<p>管道通信的规则、限制：</p>
<ul>
<li>管道只能采用<strong>半双工通信</strong>，某一时间段内只能实现单向的传输。</li>
<li>如果要实现<strong>双向同时通信</strong>，则需要设置两个管道。</li>
<li>各进程要<strong>互斥</strong>地访问管道（由操作系统实现）</li>
<li>当管道<strong>写满</strong>时，<strong>写进程</strong>将<strong>阻塞</strong>，直到读进程将管道中的数据取走，即可唤醒写进程。</li>
<li>当管道<strong>读空</strong>时，<strong>读进程</strong>将<strong>阻塞</strong>，直到写进程往管道中写入数据，即可唤醒读进程。</li>
<li>管道中的数据一旦被读出，就彻底消失。因此，当多个进程读同一个管道时，可能会错乱。对此，通常有两种解决方案：</li>
<li>一个管道允许<strong>多个写进程</strong>，<strong>一个读进程</strong>（2014 年 408 真题高教社官方答案）；</li>
<li>允许有<strong>多个写进程</strong>，<strong>多个读进程</strong>，但系统会让各个读进程轮流从管道中读数据（Linux 的方案）。</li>
</ul>
<p><img alt="管道通信" src="../../../assets/cs/os/process/%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1.png" /></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>写进程往管道写数据，即便管道没被写满，只要管道没空，读进程就可以从管道读数据</p>
</div>
<p>读进程从管道读数据，即便管道没被读空，只要管道没满，写进程就可以往管道写数据</p>
<h4 id="linux-实现">Linux 实现<a class="headerlink" href="#linux-实现" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="cp">#define BUFFER SIZE 25</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="cp">#define READ END 0</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="cp">#define WRITE END 1</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="p">{</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">msg</span><span class="p">[</span><span class="n">BUFFER</span><span class="w"> </span><span class="n">SIZE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Greetings&quot;</span><span class="p">;</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">msg</span><span class="p">[</span><span class="n">BUFFER</span><span class="w"> </span><span class="n">SIZE</span><span class="p">];</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">  </span><span class="n">pid</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">  </span><span class="cm">/* Program continues in Figure 3.22 */</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">  </span><span class="cm">/* create the pipe */</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pipe</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">&quot;Pipe failed&quot;</span><span class="p">);</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="w">  </span><span class="cm">/* fork a child process */</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">  </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fork</span><span class="p">();</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pid</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* error occurred */</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Fork Failed&quot;</span><span class="p">);</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pid</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* parent process */</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="w">    </span><span class="cm">/* close the unused end of the pipe */</span>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="n">READ</span><span class="w"> </span><span class="n">END</span><span class="p">]);</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="w">    </span><span class="cm">/* write to the pipe */</span>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="w">    </span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="n">WRITE</span><span class="w"> </span><span class="n">END</span><span class="p">],</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">write</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="w">    </span><span class="cm">/* close the write end of the pipe */</span>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="n">WRITE</span><span class="w"> </span><span class="n">END</span><span class="p">]);</span>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a><span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* child process */</span>
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="w">    </span><span class="cm">/* close the unused end of the pipe */</span>
<a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="n">WRITE</span><span class="w"> </span><span class="n">END</span><span class="p">]);</span>
<a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a><span class="w">    </span><span class="cm">/* read from the pipe */</span>
<a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="w">    </span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="n">READ</span><span class="w"> </span><span class="n">END</span><span class="p">],</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">BUFFER</span><span class="w"> </span><span class="n">SIZE</span><span class="p">);</span>
<a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;read %s&quot;</span><span class="p">,</span><span class="n">read</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span>
<a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="w">    </span><span class="cm">/* close the read end of the pipe */</span>
<a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a><span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="n">READ</span><span class="w"> </span><span class="n">END</span><span class="p">]);</span>
<a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a><span class="p">}</span>
</code></pre></div>
<p>利用 <code>libc</code> 创建、操作管道：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1">// 普通管道</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">pipefd</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">pipe</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pipefd</span><span class="p">);</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">fcntl</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pipefd</span><span class="p">[</span><span class="mi">0</span><span class="o">|</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">cmd</span><span class="p">);</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">fcntl</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pipefd</span><span class="p">[</span><span class="mi">0</span><span class="o">|</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">cmd</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">arg</span><span class="p">);</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="kt">ssize_t</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pipefd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="kt">ssize_t</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pipefd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="n">close</span><span class="p">(</span><span class="n">pipefd</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="n">close</span><span class="p">(</span><span class="n">pipefd</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="c1">// 命名管道</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="cp">#define FIFO pathname </span><span class="cm">/* pathname: &quot;/tmp/my_fifo&quot; */</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="n">unlink</span><span class="p">(</span><span class="n">FIFO</span><span class="p">);</span><span class="w"> </span><span class="cm">/*delete a name and possibly the file it refers to */</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="n">mkfifo</span><span class="p">(</span><span class="n">FIFO</span><span class="p">,</span><span class="w"> </span><span class="mo">0666</span><span class="p">);</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="kt">int</span><span class="w"> </span><span class="n">fdw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">FIFO</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDWR</span><span class="p">);</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="n">mkfifo</span><span class="p">(</span><span class="n">FIFO</span><span class="p">,</span><span class="w"> </span><span class="mo">0444</span><span class="p">);</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="kt">int</span><span class="w"> </span><span class="n">fdr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">FIFO</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDONLY</span><span class="p">);</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="kt">ssize_t</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fdw</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="cm">/* ssizt_t = signed int, sizt_t = unsigned int */</span>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="kt">ssize_t</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fdr</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="n">close</span><span class="p">(</span><span class="n">fdw</span><span class="p">);</span>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="n">close</span><span class="p">(</span><span class="n">fdr</span><span class="p">);</span>
</code></pre></div>
<p>管道缓冲</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fcntl.h&gt;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="cp">#define ERR_EXIT(m) \</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="cp">  do { \</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="cp">    perror(m); \</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="cp">    exit(EXIT_FAILURE); \</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="cp">  } while (0)</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="p">{</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">pipefd</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">bufsize</span><span class="p">;</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">lastwritten</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">totalwritten</span><span class="p">;</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">pipe</span><span class="p">(</span><span class="n">pipefd</span><span class="p">)</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="cm">/* create an ordinary pipe */</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="w">    </span><span class="n">ERR_EXIT</span><span class="p">(</span><span class="s">&quot;pipe()&quot;</span><span class="p">);</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="w">  </span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fcntl</span><span class="p">(</span><span class="n">pipefd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">F_GETFL</span><span class="p">);</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">  </span><span class="n">fcntl</span><span class="p">(</span><span class="n">pipefd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">F_SETFL</span><span class="p">,</span><span class="w"> </span><span class="n">flags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_NONBLOCK</span><span class="p">);</span><span class="w"> </span><span class="cm">/* set write_end NONBLOCK */</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="w">  </span><span class="n">bufsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;testing buffer size = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">bufsize</span><span class="p">);</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="w">  </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">bufsize</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">buffer</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">bufsize</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="w">    </span><span class="n">ERR_EXIT</span><span class="p">(</span><span class="s">&quot;malloc()&quot;</span><span class="p">);</span>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="w">  </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">pipefd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">bufsize</span><span class="p">);</span>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="w">    </span><span class="cm">/* bufsize is better to be 2^k */</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="w">      </span><span class="n">perror</span><span class="p">(</span><span class="s">&quot;write()&quot;</span><span class="p">);</span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a><span class="w">    </span><span class="n">lastwritten</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="w">    </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="w">  </span><span class="n">totalwritten</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="mi">-1</span><span class="p">)</span><span class="o">*</span><span class="n">bufsize</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="w">  </span><span class="n">lastwritten</span><span class="p">;</span>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;single pipe buffer count = %d, last written = %d bytes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">lastwritten</span><span class="p">);</span>
<a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;total written = %d bytes = %d KiB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">totalwritten</span><span class="p">,</span><span class="w"> </span><span class="n">totalwritten</span><span class="o">/</span><span class="mi">1024</span><span class="p">);</span><span class="w"> </span><span class="cm">/* pipe buffer */</span>
<a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a><span class="p">}</span>
</code></pre></div>
<h4 id="pipes-in-unix-cli">Pipes in UNIX CLI<a class="headerlink" href="#pipes-in-unix-cli" title="Permanent link">&para;</a></h4>
<p>A pipe can be constructed on the UNIX command line using the <code>|</code> character. The complete command is <code>ls | less</code></p>
<p>The commands ls and less are running as individual processes. The output of ls is delivered as the input to less.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>这里的 shell 和 ls 之间、ls 和 less 之间都是普通管道通信</p>
</div>
<h4 id="windows-实现">Windows 实现<a class="headerlink" href="#windows-实现" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;windows.h&gt;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="cp">#define BUFFER SIZE 25</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">VOID</span><span class="p">)</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="p">{</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">  </span><span class="n">HANDLE</span><span class="w"> </span><span class="n">ReadHandle</span><span class="p">,</span><span class="w"> </span><span class="n">WriteHandle</span><span class="p">;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">  </span><span class="n">STARTUPINFO</span><span class="w"> </span><span class="n">si</span><span class="p">;</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">  </span><span class="n">PROCESS</span><span class="w"> </span><span class="n">INFORMATION</span><span class="w"> </span><span class="n">pi</span><span class="p">;</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">message</span><span class="p">[</span><span class="n">BUFFER</span><span class="w"> </span><span class="n">SIZE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Greetings&quot;</span><span class="p">;</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">  </span><span class="n">DWORD</span><span class="w"> </span><span class="n">written</span><span class="p">;</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">  </span><span class="cm">/* Program continues in Figure 3.24 */</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">  </span><span class="cm">/* set up security attributes allowing pipes to be inherited */</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">  </span><span class="n">SECURITY</span><span class="w"> </span><span class="n">ATTRIBUTES</span><span class="w"> </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="k">sizeof</span><span class="p">(</span><span class="n">SECURITY</span><span class="w"> </span><span class="n">ATTRIBUTES</span><span class="p">),</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TRUE</span><span class="p">};</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">  </span><span class="cm">/* allocate memory */</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">  </span><span class="n">ZeroMemory</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pi</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">pi</span><span class="p">));</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="w">  </span><span class="cm">/* create the pipe */</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">CreatePipe</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ReadHandle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">WriteHandle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Create Pipe Failed&quot;</span><span class="p">);</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">  </span><span class="cm">/* establish the START INFO structure for the child process */</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="w">  </span><span class="n">GetStartupInfo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">si</span><span class="p">);</span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="w">  </span><span class="n">si</span><span class="p">.</span><span class="n">hStdOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetStdHandle</span><span class="p">(</span><span class="n">STD</span><span class="w"> </span><span class="n">OUTPUT</span><span class="w"> </span><span class="n">HANDLE</span><span class="p">);</span>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="w">  </span><span class="cm">/* redirect standard input to the read end of the pipe */</span>
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="w">  </span><span class="n">si</span><span class="p">.</span><span class="n">hStdInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadHandle</span><span class="p">;</span>
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w">  </span><span class="n">si</span><span class="p">.</span><span class="n">dwFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STARTF</span><span class="w"> </span><span class="n">USESTDHANDLES</span><span class="p">;</span>
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="w">  </span><span class="cm">/* don’t allow the child to inherit the write end of pipe */</span>
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="w">  </span><span class="n">SetHandleInformation</span><span class="p">(</span><span class="n">WriteHandle</span><span class="p">,</span><span class="w"> </span><span class="n">HANDLE</span><span class="w"> </span><span class="n">FLAG</span><span class="w"> </span><span class="n">INHERIT</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="w">  </span><span class="cm">/* create the child process */</span>
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a><span class="w">  </span><span class="n">CreateProcess</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;child.exe&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span>
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a><span class="w">                </span><span class="n">TRUE</span><span class="p">,</span><span class="w"> </span><span class="cm">/* inherit handles */</span>
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a><span class="w">                </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">si</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pi</span><span class="p">);</span>
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a><span class="w">  </span><span class="cm">/* close the unused end of the pipe */</span>
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a><span class="w">  </span><span class="n">CloseHandle</span><span class="p">(</span><span class="n">ReadHandle</span><span class="p">);</span>
<a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a><span class="w">  </span><span class="cm">/* the parent writes to the pipe */</span>
<a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">WriteFile</span><span class="p">(</span><span class="n">WriteHandle</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="n">BUFFER</span><span class="w"> </span><span class="n">SIZE</span><span class="p">,</span><span class="o">&amp;</span><span class="n">written</span><span class="p">,</span><span class="nb">NULL</span><span class="p">))</span>
<a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a><span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error writing to pipe.&quot;</span><span class="p">);</span>
<a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a><span class="w">  </span><span class="cm">/* close the write end of the pipe */</span>
<a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a><span class="w">  </span><span class="n">CloseHandle</span><span class="p">(</span><span class="n">WriteHandle</span><span class="p">);</span>
<a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a><span class="w">  </span><span class="cm">/* wait for the child to exit */</span>
<a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a><span class="w">  </span><span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="n">hProcess</span><span class="p">,</span><span class="w"> </span><span class="n">INFINITE</span><span class="p">);</span>
<a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a><span class="w">  </span><span class="n">CloseHandle</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="n">hProcess</span><span class="p">);</span>
<a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a><span class="w">  </span><span class="n">CloseHandle</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="n">hThread</span><span class="p">);</span>
<a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a><span class="p">}</span>
</code></pre></div>
<h3 id="客户机-服务器系统中的通信">客户机-服务器系统中的通信<a class="headerlink" href="#客户机-服务器系统中的通信" title="Permanent link">&para;</a></h3>
<ul>
<li>套接字（Socket）</li>
<li>远程过程调用（RPC）</li>
</ul>
<h4 id="套间字socket">套间字(Socket)<a class="headerlink" href="#套间字socket" title="Permanent link">&para;</a></h4>
<p>套接字被定义为通信的端点，是很多协议的底层实现方式，通信由一对套接字组成</p>
<p>IP 地址和端口的串联–包含在消息包开头的数字，用于区分主机上的网络服务；例如：套接字 <code>161.25.19.8:1625</code> 引用主机 <code>161.25.19.8</code> 上的端口 <code>1625</code> ;</p>
<ul>
<li><code>1024</code> 以下的所有端口都是相对固定的，用于标准服务；</li>
<li>特殊 IP 地址 <code>127.0.0.1</code>（环回），用于表示正在运行进程的系统；</li>
</ul>
<p>三种类型的套接字</p>
<ul>
<li>面向连接（TCP）</li>
<li>无连接（UDP）</li>
<li>Multicast Socket 类：数据可以发送到多个收件人</li>
</ul>
<h4 id="远程过程调用rpc">远程过程调用(RPC)<a class="headerlink" href="#远程过程调用rpc" title="Permanent link">&para;</a></h4>
<p>远程过程调用（RPC）是抽象网络系统上进程之间的过程调用，也使用端口进行服务区分</p>
<p>Stubs（桩函数）——服务器上实际过程的客户端代理，提供封装好的调用接口：</p>
<ul>
<li>客户端存根定位服务器并封送参数</li>
<li>服务器端存根接收此消息，解压缩封送的参数，并在服务器上执行该过程</li>
</ul>
<p>通过外部数据表示（XDL）格式处理数据表示，以考虑不同的体系结构，例如大端和小端;</p>
<p>远程通信比本地通信有更多的故障场景，消息可以只传递一次，而不是最多一次</p>
<p>操作系统通常提供会合（或配对）服务来连接客户端和服务器</p>
<p>在 Windows 上，存根代码根据用 Microsoft 接口定义语言（MIDL）编写的规范编译</p>
<p><img alt="远程过程调用" src="../../../assets/cs/os/process/%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8.png" /></p>
<h5 id="dce-rpc">DCE RPC<a class="headerlink" href="#dce-rpc" title="Permanent link">&para;</a></h5>
<p><a href="https://en.wikipedia.org/wiki/Distributed_Computing_Environment">参考</a>：Distributed Computing Environment ，OSF（开放软件基金会）下的一个软件系统框架（慢慢消亡）</p>
<p><strong>DCE</strong>的构成：</p>
<ul>
<li>远程过程调用 DCE/RPC；</li>
<li>命名/目录服务；</li>
<li>时间服务；</li>
<li>安全服务；</li>
<li>分布式文件系统 DCE/DFS；</li>
</ul>
<p>目前 Linux 标配 RPC</p>
<h2 id="进程调度">进程调度<a class="headerlink" href="#进程调度" title="Permanent link">&para;</a></h2>
<p>Process scheduler 从可用进程中选择下一个在 CPU 核心上执行的进程</p>
<p>目标——最大限度地利用 CPU，快速将进程切换到 CPU 核心</p>
<p>维护进程的<strong>调度队列</strong></p>
<ul>
<li>就绪队列 (ready queue)——驻留在主内存中、就绪并等待执行的所有进程的集合</li>
<li>等待队列 (wait queue)——等待事件（即 I/O）的一组进程</li>
<li>I/O wait queue</li>
<li>child termination wait queue</li>
<li>interrupt wait queue</li>
<li>进程在各种队列之间迁移</li>
</ul>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../memory-management/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 内存管理">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                内存管理
              </div>
            </div>
          </a>
        
        
          
          <a href="../scheduling/" class="md-footer__link md-footer__link--next" aria-label="Next: 调度">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                调度
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.path", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.prune", "navigation.indexes", "navigation.footer", "navigation.tracking", "navigation.instant", "navigation.instant.progress", "content.code.copy", "content.code.select", "content.tabs.link", "toc.follow"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>